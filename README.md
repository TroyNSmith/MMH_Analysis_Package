# MMH Analysis Package
A package of Python scripts intended to analyze simulations generated by the MMH research group.

## Pixi
This package uses [Pixi](https://pixi.sh/latest/) for environment and dependency management. Pixi is a fast, reproducible tool similar to conda, but is shipped with a software package and is fully compatible with [VS Code](https://code.visualstudio.com/). 

| Platform | Install Command or Link                                 |
| -------- | ------------------------------------------------------- |
| Windows  | Run through [WSL](https://learn.microsoft.com/en-us/windows/wsl/install) & follow Linux |
| Linux    | Run `curl -sSf https://prefix.dev/install.sh \| sh`           |

Verify installation :
```
pixi --version
```

Then restart your terminal (or follow the post-install instructions to update your `PATH`).

Inside the MMH Analysis Package folder, **activate** the environment :
```
pixi shell
```
All dependencies and tools will be available automatically in this shell.

*If you would rather use conda, necessary packages are listed under **dependencies** in `pixi.toml` and can be manually installed.*

*Note: A custom version of mdevaluate is hosted as a local module within this package.*

## How to use
Ensure that the pixi environment has been activated or all dependencies have been installed locally through an environment manager like mamba or conda.

For all of the scripts, ensure that your terminal is currently within the `src` directory :

```
cd src/
```

### pore.py

Within the `src` directory, call the main `Run` module from `pore.py` :

```
python -m pore Run --help
```

#### Options:
--- File Input / Output ---
* -i / --input (str) : Path/to/the/simulation/directory
  * Path of the parent directory for topology (.tpr), trajectory (.xtc), and structure (.gro) files.
  *  ex: `-i /home/tnsmith/simulations/octanol/nvt_prod/`
* -tr / --trajectory (str) : *input*/path/to/trajectory
  * Path to the trajectory file starting from the path specified by --input.
  *  ex: `-tr out/out.xtc`
* -tp / --topology (str) : *input*/path/to/topology
  * Path to the topology file starting from the path specified by --input.
  *  ex: `-tp run.tpr`
* -st / --structure (str) : *input*/path/to/structure
  * Path to the structure file starting from the path specified by --input.
  *  ex: `-st out/out.gro`
* -o / --output (str) : Path/to/the/output/directory (opt.)
  * Path of a directory to reroute output folders/files. (default = None)
  *  ex: `-o /home/tnsmith/simulations/octanol/nvt_prod/`

--- Topology Selections ---
* -r / --resname (str) : RES
  * Residue name identifier matching simulation topology.
  *  ex : `-r OCT`
* -a / --atoms (str) : AT1 AT2 (nargs = 2)
  * Atom name identifiers matching simulation topology.
  *  ex : `-a O01 C0O`
 
--- Analysis Parameters ---
* -s / --segments (int) : 0 < s &le; 1000
  * Number of starting points to use with correlation functions. (default = 500)
  *  ex : `-s 1000`
* -d / --diameter (float) : 0 < d
  * Diameter of the pore in nm.
  *  ex : `-d 3.0`
* -q / --q (float) : 0 < q (opt.)
  * Magnitude of the scattering vector q. (default = None)
  *  ex : `-q 12.56`
 
 --- Flags ---
* -ov / --override : 
  * Whether to overwrite existing analysis output files. (default = False)
  *  ex : `-ov`
* -po / --plot_only :
  * Only run plotting functions. (default = False)
  *  ex : `-po`

#### Full Example:
*Analyze an octanol simulation, auto-detect the q-value, dump output files to `~/input/Analysis`, and override any existing outputs.*
```
python -m pore Run -i /home/tnsmith/simulations/octanol/nvt_prod/ -tr out/out.xtc -tp run.tpr -st out/out.gro -r OCT -a O01 C0O -s 1000 -d 3.0 -ov
```

### pore.sh

Pore.sh is intended as a way to streamline batches of pore analyses through the `Run` module of `pore.py`

#### Overview
1. Open `src/pore.sh`
2. Add, delete, or update the input directories :
```
workdirs=(
    /media/mmh/ExtraSpace/Final_Pore_Analysis_Organized_TNS/pore_D3_L6_W2_S5.0_E0.0_A0.0_V0.0_no_reservoir_N1/OCT/328K/5_nvt_prod_system
    ... <- Insert new lines here
    )
```
3. Update the pore diameter and number of segments :
```
DIAMETER=3.0 <- Change these
SEGMENTS=500 <- values as needed
```
4. Add, delete, or update the values of q to use :
```
q_values=(
    12.6
    ... <- Insert new lines here
)
```
5. Add, delete, or update the *RES AT1 AT2* pairs :
```
residue_atom_list=(
    "OCT O01 H00"
    ... <- Insert new lines here
)
```
6. Within the `src` directory, call the bash script :
```
bash pore.sh
```
7. The bash script will proceed to iterate through every combination of the entries in `workdirs`, `q_values`, and `residue_atom_list`.
